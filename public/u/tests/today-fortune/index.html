<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ESTP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ESTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ESTP 운세</h1>
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ESTP 지수</div>
                <p id="mbtiIndexDisplay">ESTP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251010170000" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["당신의 뛰어난 임기응변 능력이", "현실적인 문제 해결 감각이", "새로운 도전을 두려워하지 않는 대담함이", "사람들을 끌어당기는 특유의 매력이", "현재 순간에 집중하는 에너지가"],
            verbs: ["예상치 못한 문제를 기회로 바꿉니다.", "복잡한 상황을 단순하고 명쾌하게 해결합니다.", "당신을 새로운 성공으로 이끌 것입니다.", "어떤 모임에서든 당신을 주인공으로 만듭니다.", "최고의 퍼포먼스를 발휘하게 합니다."],
            connectors: ["그러니", "이 기회를 활용해", "자신감을 갖고", "망설이지 말고"],
            actions: ["오래 고민하기보다 일단 행동으로 옮겨보세요.", "새로운 스포츠나 액티비티에 도전해 보세요.", "당신의 재치 있는 유머로 주변 분위기를 띄워보세요.", "복잡한 문제에 직면했을 때, 가장 단순하고 직접적인 해결책을 찾아보세요.", "결과를 두려워 말고 과감한 결정을 내려보세요."]
        },
        task: {
            types: ["도전하기:", "해결하기:", "내기하기:", "즐기기:"],
            actions: ["평소 어렵다고 생각했던", "지금 당장 해결해야 할", "친구와 함께 할 수 있는", "오늘 하루를 가장 짜릿하게 만들"],
            subjects: ["새로운 기술", "가장 골치 아픈 문제", "간단한 게임", "즉흥적인 활동"],
            verbs: ["을(를) 30분 안에 배워서 시도해 보세요.", "를 가장 빠르고 효율적인 방법으로 처리해 보세요.", "에서 승리하고 성취감을 만끽해 보세요.", "을(를) 계획 없이 바로 시작해 보세요."]
        },
        mbtiIndex: {
            reasons: ["뛰어난 순발력으로 위기를 기회로 만들어", "현실적인 문제 해결 능력이 빛을 발하여", "스릴 넘치는 도전 정신이 솟구쳐", "특유의 설득력으로 주변 사람들을 사로잡아"],
            results: ["어떤 돌발 상황도 능숙하게 해결할 수 있습니다.", "가장 실용적이고 효과적인 방법을 찾아냅니다.", "새로운 모험에서 큰 성취감을 맛볼 수 있습니다.", "당신이 원하는 방향으로 상황을 이끌어갈 수 있습니다."]
        },
        keywords: ["현실적인", "실용적인", "활동적인", "즉흥적인", "모험적인", "사교적인", "외향적인", "관찰력 있는", "순발력 있는", "논리적인", "객관적인", "자유분방한", "효율적인", "낙천적인", "행동 지향적", "임기응변", "위기 대처", "설득력", "리더십", "적응력", "스릴", "도전", "경험"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>